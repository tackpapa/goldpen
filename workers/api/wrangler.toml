#:schema node_modules/wrangler/config-schema.json
name = "goldpen-api"
main = "src/index.ts"
compatibility_date = "2024-11-19"
compatibility_flags = ["nodejs_compat"]
workers_dev = true

# Hyperdrive binding for Supabase Postgres
[[hyperdrive]]
binding = "HYPERDRIVE_DB"
id = "8c1cfe4c456d460da34153acc8e0eb2c"

# Workers AI binding (Qwen3 30B for Korean)
[ai]
binding = "AI"

# Observability
[observability]
enabled = true

# Development
[dev]
port = 8787
local_protocol = "http"

# Environment Variables
[vars]
# Public variables (non-sensitive)
NEXT_PUBLIC_APP_URL = "https://goldpen.kr"
NEXT_PUBLIC_SUPABASE_URL = "https://ipqhhqduppzvsqwwzjkp.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwcWhocWR1cHB6dnNxd3d6amtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MzY2MzgsImV4cCI6MjA3OTIxMjYzOH0.BiitPu3RXs-o6BSef3ds4qNUGIzyzMExB4E8TmsoCoE"

# Secrets (set via CLI or Dashboard):
# wrangler secret put SUPABASE_SERVICE_ROLE_KEY (optional, for admin operations)
# wrangler secret put SOLAPI_API_KEY (Solapi API Key)
# wrangler secret put SOLAPI_API_SECRET (Solapi API Secret)

# Solapi 알림톡 설정 (PPURIO 대체)
# SOLAPI_PF_ID = "" # 카카오 채널 연동 후 발급되는 pfId - secret으로 설정
# SOLAPI_SENDER_PHONE = "" # 발신번호 - secret으로 설정

# PPURIO 알림톡 설정 (deprecated - Solapi로 대체)
PPURIO_ACCOUNT = "ekiss"
PPURIO_SENDER_PROFILE = "@goldpen"

# Production Environment
[env.production]
name = "goldpen-api-production"
compatibility_flags = ["nodejs_compat"]
workers_dev = false

# Hyperdrive binding for production
[[env.production.hyperdrive]]
binding = "HYPERDRIVE_DB"
id = "8c1cfe4c456d460da34153acc8e0eb2c"

# Custom Domain
[[env.production.routes]]
pattern = "api.goldpen.kr/*"
zone_name = "goldpen.kr"

[env.production.vars]
NEXT_PUBLIC_APP_URL = "https://goldpen.kr"
NEXT_PUBLIC_SUPABASE_URL = "https://ipqhhqduppzvsqwwzjkp.supabase.co"
NEXT_PUBLIC_SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwcWhocWR1cHB6dnNxd3d6amtwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM2MzY2MzgsImV4cCI6MjA3OTIxMjYzOH0.BiitPu3RXs-o6BSef3ds4qNUGIzyzMExB4E8TmsoCoE"
# Solapi는 secret으로 설정: wrangler secret put SOLAPI_API_KEY / SOLAPI_API_SECRET / SOLAPI_PF_ID / SOLAPI_SENDER_PHONE
# PPURIO 설정 (deprecated)
PPURIO_ACCOUNT = "ekiss"
PPURIO_SENDER_PROFILE = "@goldpen"

# Staging Environment
[env.staging]
name = "goldpen-api-staging"
workers_dev = false

# Limits (adjust based on needs)
# [limits]
# cpu_ms = 50
