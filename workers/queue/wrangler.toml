#:schema node_modules/wrangler/config-schema.json
name = "goldpen-attendance-consumer"
main = "src/index.ts"
compatibility_date = "2024-11-19"
compatibility_flags = ["nodejs_compat"]

# Queue Consumer binding
[[queues.consumers]]
queue = "goldpen-attendance-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "goldpen-attendance-dlq"

# Hyperdrive binding for Supabase Postgres
[[hyperdrive]]
binding = "HYPERDRIVE_DB"
id = "8c1cfe4c456d460da34153acc8e0eb2c"

# Observability
[observability]
enabled = true

# Environment Variables
[vars]
NEXT_PUBLIC_SUPABASE_URL = "https://vdxxzygqjjjptzlvgrtw.supabase.co"
TIMEZONE = "Asia/Seoul"

# Solapi 알림톡 설정 (PPURIO 대체)
# Secrets로 설정: wrangler secret put SOLAPI_API_KEY / SOLAPI_API_SECRET / SOLAPI_PF_ID / SOLAPI_SENDER_PHONE

# PPURIO 알림톡 설정 (deprecated)
PPURIO_ACCOUNT = "ekiss"
PPURIO_SENDER_KEY = "@goldpen"

# Secrets (set via CLI):
# wrangler secret put SUPABASE_SERVICE_ROLE_KEY
# wrangler secret put SOLAPI_API_KEY (Solapi API Key)
# wrangler secret put SOLAPI_API_SECRET (Solapi API Secret)
# wrangler secret put SOLAPI_PF_ID (카카오 채널 pfId)
# wrangler secret put SOLAPI_SENDER_PHONE (발신번호)
# wrangler secret put TELEGRAM_BOT_TOKEN
# wrangler secret put TELEGRAM_CHAT_ID

# Production Environment
[env.production]
name = "goldpen-attendance-consumer-production"
compatibility_flags = ["nodejs_compat"]

[[env.production.hyperdrive]]
binding = "HYPERDRIVE_DB"
id = "8c1cfe4c456d460da34153acc8e0eb2c"

[[env.production.queues.consumers]]
queue = "goldpen-attendance-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "goldpen-attendance-dlq"

[env.production.vars]
NEXT_PUBLIC_SUPABASE_URL = "https://vdxxzygqjjjptzlvgrtw.supabase.co"
TIMEZONE = "Asia/Seoul"
