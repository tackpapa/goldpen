#:schema node_modules/wrangler/config-schema.json
name = "goldpen-attendance-consumer"
main = "src/index.ts"
compatibility_date = "2024-11-19"
compatibility_flags = ["nodejs_compat"]

# Queue Consumer binding
[[queues.consumers]]
queue = "goldpen-attendance-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "goldpen-attendance-dlq"

# Hyperdrive binding for Supabase Postgres
[[hyperdrive]]
binding = "HYPERDRIVE_DB"
id = "8c1cfe4c456d460da34153acc8e0eb2c"

# Observability
[observability]
enabled = true

# Environment Variables
[vars]
NEXT_PUBLIC_SUPABASE_URL = "https://vdxxzygqjjjptzlvgrtw.supabase.co"
TIMEZONE = "Asia/Seoul"

# Secrets (set via CLI):
# wrangler secret put SUPABASE_SERVICE_ROLE_KEY
# wrangler secret put KAKAO_ALIMTALK_API_KEY
# wrangler secret put KAKAO_ALIMTALK_SECRET_KEY
# wrangler secret put KAKAO_ALIMTALK_SENDER_KEY

# Production Environment
[env.production]
name = "goldpen-attendance-consumer-production"
compatibility_flags = ["nodejs_compat"]

[[env.production.hyperdrive]]
binding = "HYPERDRIVE_DB"
id = "8c1cfe4c456d460da34153acc8e0eb2c"

[[env.production.queues.consumers]]
queue = "goldpen-attendance-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "goldpen-attendance-dlq"

[env.production.vars]
NEXT_PUBLIC_SUPABASE_URL = "https://vdxxzygqjjjptzlvgrtw.supabase.co"
TIMEZONE = "Asia/Seoul"
